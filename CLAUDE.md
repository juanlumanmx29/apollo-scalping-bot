# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Apollo Scalping Bot is a cryptocurrency trading bot that uses machine learning to predict ETH/USDT price movements and execute scalping strategies. The project consists of:

- **Backend**: FastAPI Python application with ML model inference and paper trading simulation
- **Frontend**: React/Vite application for user interface and trading controls
- **Data Collection**: Historical data gathering from Binance API
- **ML Models**: Ensemble model for price prediction using technical indicators

## Architecture

### Backend (FastAPI)
- **main.py**: Primary FastAPI application with all endpoints and CORS configuration
- **features.py**: Real-time feature extraction from Binance API with ML prediction logic
- **models/**: Contains trained ML models (ensemble_model.joblib)
- Authentication via Firebase JWT tokens with HTTPBearer security
- Encrypted credential storage in Firestore using Fernet encryption
- Paper trading simulation with Apollo strategy implementation
- Multiple Binance API endpoints for redundancy (api.binance.com, api1-3.binance.com)

### Frontend (React/Vite)
- **App.jsx**: Main application component with trading interface
- **AuthContext.jsx**: Firebase authentication context
- **firebase.js**: Firebase configuration
- Real-time updates via polling (5-second intervals)

### Trading Strategy (Apollo)
- Buy signals from ML model (threshold: 0.73)
- Minimum sell: +0.16% (to cover 0.075% x2 Binance commissions)
- Stop loss: -1.0% below entry price
- Trailing stop: Activates at +0.16%, sells at 0.2% below max price
- Commission rate: 0.075% per transaction

## Development Commands

### Backend
```bash
cd backend
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
python main.py
```

### Frontend
```bash
cd frontend
npm install
npm run dev        # Development server
npm run build      # Production build
npm run preview    # Preview build
```

### Data Collection
```bash
python data_collector.py  # Requires BINANCE_API_KEY and BINANCE_API_SECRET
```

### Backend Testing
```bash
python test_backend.py    # Test backend connectivity (no auth required)
python backend/main.py    # Direct backend execution for debugging
```

## Environment Variables

### Backend (.env)
```env
FIREBASE_PROJECT_ID=apollo-7c7f6
FIREBASE_API_KEY=AIzaSyDGXADaGQX14BnXl8lGs4kLEPRGXnYYlQg
FERNET_KEY=<encryption_key>
BINANCE_API_KEY=<your_binance_api_key>
BINANCE_API_SECRET=<your_binance_secret>
```

### Frontend (.env)
```env
VITE_BACKEND_URL=https://apollo-scalping-bot-backend-production.up.railway.app
```

## Deployment

### Backend (Railway)
- Deployed from backend/ directory
- Uses Dockerfile for containerization
- Environment variables configured in Railway dashboard

### Frontend (Netlify)
- Deployed from frontend/ directory
- Build command: `npm run build`
- Publish directory: `dist`

## Key Features

### ML Model Integration
- Real-time feature extraction from Binance 1-minute candlestick data
- 19 technical indicators (RSI, Bollinger Bands, Stochastic, etc.)
- Ensemble model predictions with probability thresholds

### Paper Trading Simulation
- Simulates Apollo strategy with realistic commissions
- Real-time logging and trade tracking
- Background task execution via FastAPI BackgroundTasks

### Authentication & Security
- Firebase authentication with Google sign-in
- JWT token verification for all protected endpoints
- Encrypted credential storage using Fernet encryption

## File Structure Notes

- `analysis_results/`: Contains backtesting results and model optimization data
- `historical_data/`: CSV files with historical price data from Binance (multiple timeframes)
- `data/`: NPZ files containing processed ML datasets (ml_dataset_final.npz)
- `models/`: Trained ML models (joblib format) - duplicated in root and backend/
- `roadmap.md`: Spanish development roadmap and task tracking  
- `RAILWAY_DEPLOYMENT.md`: Railway deployment instructions
- `backend/venv/` and `venv/`: Python virtual environments (should be ignored by git)
- `frontend/dist/`: Production build output (generated by Vite)
- `frontend/node_modules/`: NPM dependencies (should be ignored by git)

## Testing

Currently no automated tests are implemented. Manual testing is performed through:
- `/health` endpoint for backend health checks
- `/test-binance` endpoint for Binance API connectivity  
- `/test-cors` endpoint for CORS configuration verification
- `test_backend.py` script for backend connectivity testing (Railway endpoint)

**Note**: No linting or code formatting tools are currently configured. Consider adding eslint for frontend and black/flake8 for backend.

## Dependencies

### Backend
- FastAPI, Uvicorn for web framework
- scikit-learn, joblib for ML model inference
- google-cloud-firestore for database
- PyJWT, cryptography for authentication and encryption
- pandas, numpy for data processing
- requests for API calls

### Frontend
- React 18 with Vite build system
- Firebase SDK for authentication
- No additional UI frameworks (vanilla CSS)

## Important Notes

- The ML model uses a 0.73 probability threshold for buy signals
- All trading is simulated (paper trading) - no real money involved
- Binance API rate limits are respected with multiple endpoint fallbacks
- Real-time data updates every 5 seconds in both backend and frontend
- Backend server runs on Railway (production) with automatic HTTPS
- Frontend deployed on Netlify with VITE_BACKEND_URL pointing to Railway
- ML features extracted from 100 most recent 1-minute candlesticks
- Commission simulation: 0.075% per transaction (buy/sell)